# lib/l10n/ - Localization Documentation

**Last Updated:** 2026-01-29

This directory contains localization files automatically generated from ARB files. **DO NOT EDIT files in this directory directly.**

## ğŸ“ Structure

```
lib/l10n/                           # Auto-generated files
â”œâ”€â”€ app_localizations.dart          # Base localization class
â”œâ”€â”€ app_localizations_vi.dart       # Vietnamese translations
â”œâ”€â”€ app_localizations_en.dart       # English translations
â””â”€â”€ app_localizations_zh.dart       # Chinese translations
```

## âš ï¸ IMPORTANT: Auto-Generated Files

**Files in this directory are automatically generated. DO NOT EDIT directly!**

To update translations:
1. âœï¸ Edit ARB files in [assets/l10n/](../../assets/l10n/)
2. ğŸ”§ Run: `flutter gen-l10n`
3. âœ… Files in `lib/l10n/` will be auto-regenerated

---

## ğŸŒ Supported Languages

| Language | Code | Template | Generated File |
|----------|------|----------|----------------|
| Vietnamese (Default) | `vi` | [assets/l10n/app_vi.arb](../../assets/l10n/app_vi.arb) | [app_localizations_vi.dart](app_localizations_vi.dart) |
| English | `en` | [assets/l10n/app_en.arb](../../assets/l10n/app_en.arb) | [app_localizations_en.dart](app_localizations_en.dart) |
| Chinese | `zh` | [assets/l10n/app_zh.arb](../../assets/l10n/app_zh.arb) | [app_localizations_zh.dart](app_localizations_zh.dart) |

---

## ğŸ“ ARB Files Location

**Source files (Edit these):**
- Vietnamese: [assets/l10n/app_vi.arb](../../assets/l10n/app_vi.arb) **(Template)**
- English: [assets/l10n/app_en.arb](../../assets/l10n/app_en.arb)
- Chinese: [assets/l10n/app_zh.arb](../../assets/l10n/app_zh.arb)

**Configuration:** [l10n.yaml](../../l10n.yaml)
```yaml
arb-dir: assets/l10n
template-arb-file: app_vi.arb          # Template file
output-localization-file: app_localizations.dart
output-dir: lib/l10n                   # Generated files
```

---

## ğŸ”§ Working with Translations

### 1. Adding New Translation Keys

**Step 1: Edit Template ARB File**
```json
// assets/l10n/app_vi.arb
{
  "@@locale": "vi",

  "myNewKey": "Vietnamese value",
  "@myNewKey": {
    "description": "Description of this key's meaning"
  }
}
```

**Step 2: Add to Other Languages**
```json
// assets/l10n/app_en.arb
{
  "@@locale": "en",
  "myNewKey": "English value"
}

// assets/l10n/app_zh.arb
{
  "@@locale": "zh",
  "myNewKey": "ä¸­æ–‡å€¼"
}
```

**Step 3: Generate**
```bash
flutter gen-l10n
```

**Step 4: Use in Code**
```dart
Text(AppLocalizations.of(context)!.myNewKey)
```

### 2. Translation Keys with Parameters

**ARB Definition:**
```json
{
  "greeting": "Hello {name}!",
  "@greeting": {
    "description": "Greeting message with user name",
    "placeholders": {
      "name": {
        "type": "String",
        "example": "John"
      }
    }
  },

  "itemCount": "You have {count} items",
  "@itemCount": {
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

**Usage:**
```dart
Text(AppLocalizations.of(context)!.greeting('John'))
// Output: "Hello John!"

Text(AppLocalizations.of(context)!.itemCount(5))
// Output: "You have 5 items"
```

### 3. Plural Translations

**ARB Definition:**
```json
{
  "projectCount": "{count, plural, =0{No projects} =1{1 project} other{{count} projects}}",
  "@projectCount": {
    "description": "Number of projects",
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

**Usage:**
```dart
AppLocalizations.of(context)!.projectCount(0)  // "No projects"
AppLocalizations.of(context)!.projectCount(1)  // "1 project"
AppLocalizations.of(context)!.projectCount(5)  // "5 projects"
```

### 4. Date & Number Formatting

**ARB Definition:**
```json
{
  "lastUpdated": "Last updated: {date}",
  "@lastUpdated": {
    "placeholders": {
      "date": {
        "type": "DateTime",
        "format": "yMd"
      }
    }
  }
}
```

**Usage:**
```dart
AppLocalizations.of(context)!.lastUpdated(DateTime.now())
// Output: "Last updated: 1/29/2026"
```

---

## ğŸ’» Usage in Code

### Basic Usage

```dart
import 'package:flutter/material.dart';
import 'package:construction_project/l10n/app_localizations.dart';

class MyWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final l10n = AppLocalizations.of(context)!;

    return Column(
      children: [
        Text(l10n.appName),
        Text(l10n.welcome),
        ElevatedButton(
          onPressed: () {},
          child: Text(l10n.submit),
        ),
      ],
    );
  }
}
```

### With Validators

```dart
import 'package:construction_project/core/utils/validators.dart';

TextFormField(
  validator: Validators.email(context),
  // Internally uses: AppLocalizations.of(context)!.invalidEmail
)

TextFormField(
  validator: Validators.required(context),
  // Uses: AppLocalizations.of(context)!.fieldRequired
)
```

### Shorthand

```dart
// Define extension for convenience
extension L10nExtension on BuildContext {
  AppLocalizations get l10n => AppLocalizations.of(this)!;
}

// Usage
Text(context.l10n.appName)
Text(context.l10n.welcome)
```

---

## ğŸ”„ Changing Language at Runtime

### Using LocaleProvider

```dart
import 'package:provider/provider.dart';
import 'package:construction_project/core/providers/locale_provider.dart';

// Get current locale
Locale currentLocale = context.read<LocaleProvider>().locale;

// Change language
context.read<LocaleProvider>().setLocale(Locale('en'));

// Language selector example
PopupMenuButton<Locale>(
  icon: Icon(Icons.language),
  onSelected: (Locale locale) {
    context.read<LocaleProvider>().setLocale(locale);
  },
  itemBuilder: (context) => [
    PopupMenuItem(
      value: Locale('vi'),
      child: Text('Vietnamese ğŸ‡»ğŸ‡³'),
    ),
    PopupMenuItem(
      value: Locale('en'),
      child: Text('English ğŸ‡¬ğŸ‡§'),
    ),
    PopupMenuItem(
      value: Locale('zh'),
      child: Text('Chinese ğŸ‡¨ğŸ‡³'),
    ),
  ],
)
```

### Persistence

Language is automatically saved to SharedPreferences:
- Key: `'selectedLocale'`
- Auto-restore when app restarts
- Managed by [LocaleProvider](../core/providers/locale_provider.dart)

---

## ğŸ“‹ Common Translation Keys

### Common Categories in ARB Files:

```json
{
  "@@locale": "vi",

  // App Info
  "appName": "Construction Project",

  // Common Actions
  "save": "Save",
  "cancel": "Cancel",
  "delete": "Delete",
  "edit": "Edit",
  "add": "Add",
  "submit": "Submit",
  "confirm": "Confirm",

  // Common Labels
  "search": "Search",
  "filter": "Filter",
  "sort": "Sort",
  "loading": "Loading...",

  // States
  "error": "Error",
  "success": "Success",
  "warning": "Warning",

  // Auth
  "login": "Login",
  "logout": "Logout",
  "register": "Register",
  "email": "Email",
  "password": "Password",

  // Validation Messages
  "fieldRequired": "This field is required",
  "invalidEmail": "Invalid email",
  "invalidPhone": "Invalid phone number",
  "passwordTooShort": "Password too short",
  "passwordMismatch": "Password mismatch"
}
```

---

## ğŸ§ª Testing Translations

### Test with Different Locales

```dart
testWidgets('Widget displays correct translation', (tester) async {
  await tester.pumpWidget(
    MaterialApp(
      locale: Locale('vi'),
      localizationsDelegates: [
        AppLocalizations.delegate,
        // ... other delegates
      ],
      supportedLocales: [Locale('vi')],
      home: MyWidget(),
    ),
  );

  expect(find.text('Construction Project'), findsOneWidget);
});
```

---

## ğŸ¯ Best Practices

### âœ… DO:
- Always edit ARB files, never generated Dart files
- Run `flutter gen-l10n` after changing ARB files
- Use descriptive key names: `loginButton`, not `btn1`
- Add `@key` descriptions for context
- Keep translations consistent across languages
- Use placeholders for dynamic content
- Test with all supported languages

### âŒ DON'T:
- Don't edit files in `lib/l10n/` directly
- Don't hardcode strings in UI code
- Don't forget to add keys to all language files
- Don't use machine translation without review
- Don't create duplicate keys
- Don't use special characters in key names

### Naming Conventions:
```
âœ… Good:
- loginButton
- welcomeMessage
- errorInvalidEmail
- dialogConfirmDelete

âŒ Bad:
- btn1
- msg
- error1
- dialog
```

---

## ğŸš€ Adding a New Language

**Step 1: Create ARB File**
```bash
# Create new ARB file
touch assets/l10n/app_ja.arb
```

**Step 2: Add Translations**
```json
{
  "@@locale": "ja",
  "appName": "å»ºè¨­ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
  "welcome": "ã‚ˆã†ã“ã",
  // ... copy all keys from template
}
```

**Step 3: Update MaterialApp**
```dart
// main.dart
supportedLocales: const [
  Locale('vi'),
  Locale('en'),
  Locale('zh'),
  Locale('ja'), // Add new locale
],
```

**Step 4: Generate**
```bash
flutter gen-l10n
```

**Step 5: Add to Language Selector**
```dart
PopupMenuItem(
  value: Locale('ja'),
  child: Text('æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ'),
),
```

---

## ğŸ” Debugging

### Missing Translation Keys

**Error:**
```
NoSuchMethodError: The getter 'myKey' was called on null.
```

**Solutions:**
1. Check key exists in all ARB files
2. Run `flutter gen-l10n`
3. Hot restart app (hot reload may not work)
4. Clean build: `flutter clean && flutter pub get`

### Wrong Language Displayed

**Check:**
1. Is LocaleProvider setting the correct locale?
2. Is the ARB file's locale code correct? (`"@@locale": "vi"`)
3. Is the locale in `supportedLocales`?

### Generation Issues

```bash
# Clean and regenerate
flutter clean
flutter pub get
flutter gen-l10n
```

---

## ğŸ“Š Translation Status

To track translation completeness, compare key counts:

```bash
# Count keys in each ARB file
grep -c '"[^@]' assets/l10n/app_vi.arb
grep -c '"[^@]' assets/l10n/app_en.arb
grep -c '"[^@]' assets/l10n/app_zh.arb
```

All files should have the same number of keys (excluding metadata `@key` entries).

---

## ğŸ”„ Updating This File

**IMPORTANT:** Whenever there are changes related to localization:

### When adding a new language:
1. Document locale code and ARB file path
2. Update supported locales list
3. Update language selector example
4. Update "Last Updated"

### When adding new translation categories:
1. Document category name and purpose
2. List common keys in the category
3. Add usage examples

### When changing usage patterns:
1. Update usage examples
2. Add migration notes if breaking changes
3. Update best practices if needed

**Example commit:**
```
docs: update L10N.md - added Japanese language support
```
