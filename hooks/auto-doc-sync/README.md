# Auto Documentation Sync Hook

T·ª± ƒë·ªông c·∫≠p nh·∫≠t documentation khi c√≥ git changes. Gi√∫p team 100+ developers lu√¥n sync context.

## V·∫•n ƒê·ªÅ Gi·∫£i Quy·∫øt

### Tr∆∞·ªõc khi c√≥ hook:
‚ùå Developers kh√¥ng bi·∫øt ai ƒë√£ thay ƒë·ªïi g√¨
‚ùå Module docs l·ªói th·ªùi
‚ùå Conflicts do nhi·ªÅu ng∆∞·ªùi code c√πng l√∫c
‚ùå M·∫•t th·ªùi gian ƒë·ªçc git log
‚ùå Context b·ªã m·∫•t khi c√≥ ng∆∞·ªùi m·ªõi join

### Sau khi c√≥ hook:
‚úÖ T·ª± ƒë·ªông c·∫≠p nh·∫≠t CHANGES.md sau m·ªói commit
‚úÖ Module docs lu√¥n fresh
‚úÖ CONTEXT.md t·ªïng h·ª£p 24h activity
‚úÖ Bi·∫øt ai ƒëang l√†m g√¨, ·ªü ƒë√¢u
‚úÖ Onboarding nhanh h∆°n

---

## C√°ch Ho·∫°t ƒê·ªông

```
Developer commits
       ‚Üì
Hook triggers (PostToolUse)
       ‚Üì
Analyze git changes
       ‚Üì
Update 3 lo·∫°i files:
  1. CHANGES.md (global changelog)
  2. docs/modules/*.md (per-module)
  3. docs/CONTEXT.md (team context)
       ‚Üì
Team lu√¥n sync!
```

---

## Installation

### 1. Copy Hook

```bash
cp hooks/auto-doc-sync/* your-project/.claude/hooks/
chmod +x your-project/.claude/hooks/auto-doc-sync.js
```

### 2. Configure settings.json

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "node \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/auto-doc-sync.js"
          }
        ]
      }
    ]
  }
}
```

### 3. Create Docs Structure

```bash
mkdir -p docs/modules
touch CHANGES.md
touch docs/CONTEXT.md
```

---

## Generated Files

### 1. CHANGES.md (Root Level)

Global changelog cho to√†n b·ªô project.

```markdown
# Changes Log

Track all changes to the codebase.

## 2026-01-29

- **a1b2c3d** by john (2 hours ago)
  Implement OAuth2 login flow
  Files: src/auth/oauth.ts, src/auth/login.ts

- **d4e5f6g** by sarah (4 hours ago)
  Fix session timeout bug
  Files: src/auth/session.ts

- **h7i8j9k** by mike (6 hours ago)
  Refactor token validation
  Files: src/auth/token.ts, tests/auth.test.ts

## 2026-01-28

...
```

### 2. docs/modules/{module}.md

Per-module documentation v·ªõi recent changes.

```markdown
# auth Module

## Overview

Authentication and authorization module.

## Recent Changes

### 2026-01-29

- Implement OAuth2 login flow (a1b2c3d) by john
- Fix session timeout bug (d4e5f6g) by sarah
- Refactor token validation (h7i8j9k) by mike

Affected files:
- src/auth/oauth.ts
- src/auth/login.ts
- src/auth/session.ts
- src/auth/token.ts
- tests/auth.test.ts

### 2026-01-28

...
```

### 3. docs/CONTEXT.md

Team synchronization context.

```markdown
# Project Context

Auto-generated context for team synchronization.

## Current State

Last updated: 2026-01-29T14:30:00.000Z

## Recent Activity Summary

### Last 24 Hours

- **auth**: 3 commit(s)
- **api**: 5 commit(s)
- **components**: 2 commit(s)
```

---

## Module Detection

Hook t·ª± ƒë·ªông detect module t·ª´ file paths:

| Path Pattern | Module |
|-------------|--------|
| `src/auth/**` | auth |
| `src/api/**` | api |
| `src/components/**` | components |
| `lib/**` | lib |
| `utils/**` | utils |
| Other | core |

### Customize Module Detection

Edit `auto-doc-sync.js`:

```javascript
function detectModule(filePath) {
  if (filePath.startsWith('src/features/')) {
    return filePath.split('/')[2]; // src/features/payments/... ‚Üí payments
  }

  if (filePath.startsWith('packages/')) {
    return filePath.split('/')[1]; // packages/ui/... ‚Üí ui
  }

  // Default patterns...
}
```

---

## Configuration

Hook c√≥ th·ªÉ config qua code:

```javascript
const config = {
  changesFile: path.join(projectDir, 'CHANGES.md'),
  moduleDocsDir: path.join(projectDir, 'docs/modules'),
  contextFile: path.join(projectDir, 'docs/CONTEXT.md'),
  maxChangesEntries: 50  // Limit CHANGES.md size
};
```

---

## Use Cases

### Case 1: Developer Pull Code M·ªõi

```bash
git pull origin main
# Hook auto-triggers, updates docs

# Dev ƒë·ªçc
cat docs/CONTEXT.md
# ‚Üí Bi·∫øt ngay 24h changes, module n√†o hot
```

### Case 2: Tr∆∞·ªõc Khi Code

```bash
# Dev mu·ªën s·ª≠a auth module
cat docs/modules/auth.md

# ‚Üí Xem recent changes
# ‚Üí Bi·∫øt ai ƒëang l√†m g√¨
# ‚Üí Tr√°nh conflicts
```

### Case 3: Onboarding Dev M·ªõi

```bash
# New dev join team
cat CHANGES.md           # Xem global history
cat docs/CONTEXT.md      # Xem current state
cat docs/modules/*.md    # Xem t·ª´ng module
```

### Case 4: Team Standup

```bash
# Scrum master check activity
cat docs/CONTEXT.md

# ‚Üí Bi·∫øt ai l√†m g√¨ yesterday
# ‚Üí Module n√†o c√≥ progress
# ‚Üí Blockers ti·ªÅm nƒÉng
```

---

## K·∫øt H·ª£p v·ªõi /sync Command

```markdown
User: /sync auth

Claude reads:
1. docs/modules/auth.md (auto-generated by hook)
2. git log --since="24 hours"
3. docs/CONTEXT.md

Claude responds:
üîç Auth Module - Last 24h

3 commits by 2 developers:
- @john: OAuth2 implementation
- @sarah: Session bug fix

‚ö†Ô∏è High activity - coordinate before coding!
```

---

## Advanced Features

### 1. Customize Commit Message Format

```javascript
// In auto-doc-sync.js
function formatCommitEntry(commit) {
  return `- **[${commit.hash}]** ${commit.message}\n` +
         `  üë§ ${commit.author} ‚Ä¢ ‚è∞ ${commit.time}\n` +
         `  üìÅ Files: ${commit.files.length}\n`;
}
```

### 2. Add Team Notifications

```javascript
// Send to Slack/Discord after update
function notifyTeam(moduleChanges) {
  const modules = Object.keys(moduleChanges).join(', ');
  exec(`curl -X POST ${SLACK_WEBHOOK} -d "Docs updated: ${modules}"`);
}
```

### 3. Generate Summary Report

```javascript
function generateWeeklySummary() {
  const commits = exec('git log --since="7 days ago" --pretty=format:"%h|%an|%s"');
  // Generate summary PDF or email
}
```

---

## Troubleshooting

### Hook kh√¥ng ch·∫°y

```bash
# Check permissions
chmod +x .claude/hooks/auto-doc-sync.js

# Test manually
echo '{"tool_name":"Bash","tool_input":{"command":"git commit -m test"}}' | \
  node .claude/hooks/auto-doc-sync.js
```

### Docs kh√¥ng update

```bash
# Check git log access
git log --since="24 hours ago"

# Check write permissions
ls -la docs/
```

### Too many commits

```javascript
// Adjust time window in config
const since = '12 hours ago'; // Instead of 24 hours
```

---

## Best Practices

1. **Commit th∆∞·ªùng xuy√™n** - Hook ch·∫°y sau m·ªói commit
2. **Meaningful commit messages** - S·∫Ω xu·∫•t hi·ªán trong docs
3. **Review docs ƒë·ªãnh k·ª≥** - ƒê·∫£m b·∫£o accuracy
4. **Cleanup old entries** - Archive CHANGES.md h√†ng th√°ng
5. **Combine v·ªõi /sync command** - Maximize productivity

---

## Performance

- **Overhead**: ~100-200ms per commit
- **Files scanned**: Ch·ªâ last 24h
- **Max commits processed**: 50 (configurable)
- **Impact**: Minimal - ch·∫°y background

---

## Team Size Support

| Team Size | Performance | Recommended Config |
|-----------|-------------|-------------------|
| 1-10 devs | Excellent | Default settings |
| 10-50 devs | Good | lookback: 12 hours |
| 50-100 devs | Good | lookback: 6 hours |
| 100+ devs | Adjust needed | lookback: 3 hours, max: 30 |

---

## Example Workflow (100 Devs Team)

```
Morning (9 AM):
  ‚Üí 15 devs pull latest code
  ‚Üí Hook updates docs v·ªõi yesterday commits
  ‚Üí Each dev runs /sync ƒë·ªÉ xem context

During Day:
  ‚Üí Devs commit throughout day
  ‚Üí Hook incrementally updates docs
  ‚Üí Docs always fresh

Afternoon (3 PM):
  ‚Üí Sprint planning meeting
  ‚Üí Review docs/CONTEXT.md
  ‚Üí Identify bottlenecks, conflicts

End of Day:
  ‚Üí Archive CHANGES.md if needed
  ‚Üí Summary report generated
```

---

## Future Enhancements

- [ ] AI-powered change summaries
- [ ] Conflict prediction
- [ ] Auto-assign reviewers based on module ownership
- [ ] Integration with Jira/Linear
- [ ] Slack/Discord notifications
- [ ] Weekly/monthly reports

---

## License

Apache 2.0
